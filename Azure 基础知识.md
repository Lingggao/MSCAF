# Azure 基础知识

> 整 理 | **Ling Gao (高楷修)**  
> 身 份 | **Microsoft 微软全球学生大使**  
> 日 期 | **2020 年 9 月 8 日**  

## 一、云概念 - 云计算的原则

:one: ​用户可以通过云计算服务**租用其他公司计算机上的存储空间或 CPU 周期等资源**。

:two: ​云提供商主要提供以下**四种服务**：

1. **计算能力**
	- 虚拟机
	- 容器
	- 无服务器计算

3. **存储**
	- 结构化
	- 半结构化
	- 非结构化

4. **网络**
5. **分析**

:three: ​云计算的**七大优势**：

1. **经济高效**：即用即付、随时停止、基于使用量进行付费、便于预测成本。
2. **可缩放**：可以根据需求自由的增减使用的资源与服务。
	- 垂直扩展（纵向扩展）：添加资源以增强现有服务器功能 [例如添加更多的 CPU 与内存]。
	- 水平扩展（横向扩展）：添加更多的服务器共同工作。

4. **有弹性**：在需求变化时可以自动增减资源进行补偿。
5. **保持最新**：消除 IT 负担，更新与维护工作由云提供商负责。
6. **可靠**：数据备份、灾难恢复、数据复制、容错、遍布全球各地的数据中心。
7. **安全**：物理安全性、数字安全性。
7. **确保合规**：帮助企业遵守所在地相关的法规和标准。

:four: 支出的**两种投资方式**：

1. **资本支出 (CapEx)**：预先将资金花在实体基础设施上、前期成本 [本地数据中心]。
	- 服务器成本：硬件与支持成本 [容错、冗余、集群、电源]。
	- 存储成本：硬件与支持成本。
	- 网络成本：硬件成本 [电缆、交换机、路由器、广域网、Internet 连接]。
	- 备份成本：备份、维护成本。
	- 灾难恢复成本：灾难恢复站点成本 [备用发电机、基础设施建设]。
	- 基建成本：建筑成本 [电力、面积、冷却]。
	- 技术人员成本：雇佣技术专家和工作人员。
	- **优点**：可以在项目初期规划成本与预测费用。
	- **缺点**：需求和增长可能无法预测，并且可能超出预期。

2. **运营支出 (OpEx)**：预先将资金花在付费购买服务或产品上、无前期成本 [租用云计算服务]。
	- 租用软件：用户主动管理订阅、提供资源后开始计费、不使用时取消资源。
	- 根据使用需求增减费用：可以通过分配的 RAM、每秒 I/O 操作数 (IOPS) 等方式计费。
	- 按照用量付费。
	- **优点**：云服务具有敏捷性，便于动态管理成本，随着需求的变化优化支出。

:five: 云计算的**三种部署方法​**：

1. **公有云**：用户无需管理本地硬件，所有内容全部在云提供商的硬件上运行。
	- 优点：高伸缩性，高敏捷性，即用即付，无需更新维护硬件，无需掌握专业知识。
	- 缺点：无法满足特定的安全与业务需求、政府政策、行业标准、法律要求，无法自由管理硬件。

2. **私有云**：用户全权负责购买与维护硬件和软件，在自己的数据中心创建云环境以模拟公有云。
	- 优点：可以支持任何场景，方便控制安全性，可以满足严格的合规性与法律要求。
	- 缺点：存在初始 CapEx 成本，需要自行购买硬件，敏捷性极低，需要专业知识。

3. **混合云**：结合公有云与私有云 [例如企业在公有云中托管网站，并将其链接到托管在私有云（或本地数据中心）中的高度安全的数据库]。部分内容出于法律或版本老旧等原因无法放入云中的话，也可以使用混合云。
	- 优点：可以确保稳定运行、拥有极高的灵活性。
	- 缺点：部署昂贵、管理复杂。

:six: 云计算的**三个类别**：​

1. **基础结构即服务 (IaaS)**：用户在最大程度上控制硬件，与云提供商共同承担管理责任。
	- 迁移工作负载：IaaS 设施的管理方式与本地基础结构类似。
	- 测试和开发：更加实惠。
	- 存储、备份和恢复：IaaS 对于管理无法预测的需求和稳定增长的存储需求非常有用。

2. **平台即服务 (PaaS)**：用户无需管理底层基础结构，例如无需自行安装操作系统或 Web 服务器等。
	- 开发框架：Paas 提供了用于开发基于云的应用程序的框架。
	- 商业智能：PaaS 提供了用于分析和挖掘数据的工具。

3. **软件即服务 (SaaS)**：用户只需使用软件即可，不需要对软件的任何维护或管理工作负责 [Microsoft 365]。

![5-layer-diagram](https://github.com/Lingggao/MSCAF/blob/master/5-layer-diagram.png?raw=true)

## 二、创建 Azure 帐户

:one: Azure 订阅是用于在 Azure 中预置资源的逻辑容器。创建 Azure 资源时，需要确定其所属的订阅。

:two: 每个账户可以根据需求创建**多个** Azure 订阅。

:three: Azure 根据使用情况**每月**计费一次。

## 三、核心云服务 - Azure 简介

:one: 全球财富 500 强企业中，有超过 450 个企业 (> 90%) 将业务放在 Microsoft 云上运行。​

:two: Azure 是 Microsoft 的云计算平台，是一系列持续扩展的云服务，可帮助组织迎接当前和未来的业务挑战。Azure 提供超过 100 种服务，分为以下**十类**：

1. **计算**
2. **网络**
3. **存储**
4. **移动**
5. **数据库**
6. **Web**
7. **物联网**
8. **大数据**
9. **人工智能**
10. **DevOps**

![3-azure-services](https://github.com/Lingggao/MSCAF/blob/master/3-azure-services.png?raw=true)

## 四、核心云服务 - Azure 体系结构和服务保证

:one: Microsoft Azure 提供**可靠、冗余、高能效**的基础结构：

1. 实现**全球覆盖**。
2. 获得**本地影响力**。
3. 确保**数据安全**与**符合法律**。
4. 减少**碳排放量**。

:two: Microsoft Azure 由遍布全球的数据中心组成，在创建资源或使用服务时会使用其中一个或多个位置的物理设备。Azure 会将数据中心归入不同的**区域**。

:three: ​**区域**：是指地球上的某个地理区域，包含至少一个（或多个）数据中心，这些数据中心彼此相邻并通过一个低延迟的网络相互连接。Azure 智能地分配和控制每个区域内的资源，以确保适当平衡工作负载。

1. 美国西部。
2. 加拿大中部。
3. 西欧。
4. 中国东部。
5. *等*

![2-regions-small](https://github.com/Lingggao/MSCAF/blob/master/2-regions-small.png?raw=true)

:four: **地域**：Azure 将世界划分为由**地缘政治边界或国家/地区边界**定义的多个地域。每个地域代表一个独立市场，通常包含两个或多个**区域**。每个区域只属于某一个地域。

1. 美洲
2. 欧洲
3. 亚太区
4. 中东和非洲

:five: **可用性区域**：指的是 Azure **区域**中的物理上独立的数据中心，Azure 可以通过可用性区域帮助实现应用的高可用性。每个可用性区域都由一个或多个数据中心组成，这些数据中心都配置了独立的电源、冷却和网络设备。如果一个区域出现故障，其他区域会继续正常工作。并非每个区域都支持可用性区域。

![4-availability-zones](https://github.com/Lingggao/MSCAF/blob/master/4-availability-zones.png?raw=true)

:six: **区域对**：在同一**地域**内，每个 Azure 区域始终与至少距其 **300 英里外**的另一区域配对。区域对是直接相连的，并且距离足够远，能够与区域性灾难相隔离，因此可以使用它们来提供可靠的服务和数据冗余。区域对有助于减少因**自然灾害、社会动乱、电力中断或物理网络中断**等事件造成服务中断的可能性。

![5-region-pairs](https://github.com/Lingggao/MSCAF/blob/master/5-region-pairs.png?raw=true)

:seven: **服务级别协议 (SLA)** 描述了 Microsoft 为 Azure 客户定义了适用于 Azure 的特定性能标准。每个 Azure 产品和服务都有相对应的 SLA。SLA 有**三个主要特征**：

1. **性能目标**：SLA 定义了 Azure 产品或服务的性能目标，通常以**运行时间保证**或连接速率表示。
2. **运行时间和连接性保证**：SLA 为每个产品或服务规定了从 99.9% 到 99.999% 的性能目标承诺。

| SLA %  | 每周停机时间 | 每月停机时间 | 每年停机时间 |
| :----: | :----------: | :----------: | :----------: |
|   99   |  1.68 小时   |   7.2 小时   |   3.65 天    |
|  99.9  |  10.1 分钟   |  43.2 分钟   |  8.76 小时   |
| 99.95  |    5 分钟    |  21.6 分钟   |  4.38 小时   |
| 99.99  |  1.01 分钟   |  4.32 分钟   |  52.56 分钟  |
| 99.999 |     6 秒     |   25.9 秒    |  5.26 分钟   |

3. **服务信用额度**：当 Azure 产品或服务无法履行其适用 SLA 的规范时，Microsoft 将进行相应的**补偿**。

## 五、核心云服务 - 使用 Azure 门户管理服务

:one: 用于日常管理 Azure 与交互的工具包括：

1. **Azure 门户**：通过图形用户界面 (GUI) 与 Azure 交互。
2. **Azure PowerShell 与 Azure 命令行接口 (CLI)**：进行基于命令行和自动化的交互。
3. **Azure Cloud Shell**：基于 Web 的命令行接口。
4. **Azure 移动应用**：监视和管理移动设备上的资源。

:two: Azure 仪表板存储为 **JSON** 文件，支持上传和下载以与 Azure 目录的其他成员共享。

## 六、核心云服务 - Azure 计算选项

:one: Azure 计算是一种按需计算服务，用于运行基于云的应用程序。

:two: 在 Azure 中执行计算的**四种常用技术**：

1. **虚拟机**：物理计算机的软件模拟。用户可以像使用物理计算机一样安装和运行软件。
2. **容器**：用于运行应用程序的虚拟化环境，容器不包含在其内部运行的应用的操作系统。
3. **Azure 应用服务**：平台即服务 (PaaS) 产品，为托管面向 Web 的企业级应用程序而设计。
4. **无服务器计算**：可运行代码，但是将基础托管环境完全抽象化。

---

:three: **Azure 虚拟机 (VM)** 以虚拟服务器的形式提供基础结构即服务 (IaaS)。就像物理计算机一样，可以自定义在 VM 上运行的所有软件。用户无需购买和维护运行 VM 的物理硬件，但是仍需对 VM 自身进行维护。

:four: 有如下需求时，**虚拟机**是理想的选择：

1. 需要完全控制操作系统 (OS)。
2. 需要运行自定义软件。
3. 需要使用自定义托管配置。

:five: 用于缩放 Azure 虚拟机的**三种功能**：

1. **可用性集**：两个或多个 VM 的逻辑分组，这些 VM 帮助确保应用程序在计划内或计划外维护期间可用。
2. **虚拟机规模集**：创建并管理一组完全相同的、负载均衡的 VM。
3. **Azure Batch**：使大规模作业计划和计算管理能够扩展到数十、数百或数千个 VM。

---

:six: **容器**用于在单个主机上运行应用程序的多个实例。容器是修改后的运行时环境，基于执行应用程序的主机操作系统生成。容器不使用虚拟化，因此它不会浪费使用冗余操作系统模拟虚拟硬件的资源。容器是受保护且隔离的，不需要为每个应用提供单独的服务器。

- **优点**：节约资源、响应快速、可以在单个主机上运行多个应用程序。

:seven: Azure 支持 **Docker 容器**（一种标准化容器模型）。

:eight: 管理 Azure 容器的**两种方法**：

1. **Azure 容器实例 (ACI)**：PaaS 服务、快速简单、用户无需管理任何虚拟机或配置其他服务。
2. **Azure Kubernetes 服务 (AKS)**：面向自动化和管理大量容器的完整业务流程服务。

:nine: 容器通常用于使用**微服务**体系结构创建解决方案。微服务指的是将解决方案拆分为各个较小的独立部分 [例如可以将网站拆分为三个容器，一个用于托管前端，另一个用于托管后端，第三个用于存储]。

